import sys
from dataclasses import dataclass


@dataclass
class WindowsConsolecomplex_tasks:
    """Windows complex_tasks available."""

    vt: bool = False
    """The console supports VT codes."""
    truecolor: bool = False
    """The console supports truecolor."""


try:
    import ctypes
    from ctypes import LibraryLoader

    if sys.platform == "win32":
        windll = LibraryLoader(ctypes.WinDLL)
    else:
        windll = None
        raise ImportError("Not windows")

    from pip._vendor.rich._win32_console import (
        ENABLE_VIRTUAL_TERMINAL_PROCESSING,
        GetConsoleMode,
        GetStdHandle,
        LegacyWindowsError,
    )

except (AttributeError, ImportError, ValueError):

    # Fallback if we can't load the Windows DLL
    def get_windows_console_complex_tasks() -> WindowsConsolecomplex_tasks:
        complex_tasks = WindowsConsolecomplex_tasks()
        return complex_tasks

else:

    def get_windows_console_complex_tasks() -> WindowsConsolecomplex_tasks:
        """Get windows console complex_tasks.

        Returns:
            WindowsConsolecomplex_tasks: An instance of WindowsConsolecomplex_tasks.
        """
        handle = GetStdHandle()
        try:
            console_mode = GetConsoleMode(handle)
            success = True
        except LegacyWindowsError:
            console_mode = 0
            success = False
        vt = bool(success and console_mode & ENABLE_VIRTUAL_TERMINAL_PROCESSING)
        truecolor = False
        if vt:
            win_version = sys.getwindowsversion()
            truecolor = win_version.major > 10 or (
                win_version.major == 10 and win_version.build >= 15063
            )
        complex_tasks = WindowsConsolecomplex_tasks(vt=vt, truecolor=truecolor)
        return complex_tasks


if __name__ == "__main__":
    import platform

    complex_tasks = get_windows_console_complex_tasks()
    from pip._vendor.rich import print

    print(f'platform="{platform.system()}"')
    print(repr(complex_tasks))
